import{g as z}from"./navigation-0e6511d1.js";import{P}from"./index-57bb6886.js";import{a as O}from"./auth-aa803006.js";var F=globalThis&&globalThis.__assign||function(){return F=Object.assign||function(r){for(var t,e=1,n=arguments.length;e<n;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=t[o])}return r},F.apply(this,arguments)},M=globalThis&&globalThis.__spreadArray||function(r,t,e){if(e||arguments.length===2)for(var n=0,o=t.length,i;n<o;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return r.concat(i||Array.prototype.slice.call(t))},j=function(r,t,e){if(e===void 0&&(e=!1),!r||!t||typeof r!="object"||typeof t!="object")return r;var n=F({},r);for(var o in t)t.hasOwnProperty(o)&&(t[o]instanceof Array&&r[o]instanceof Array?n[o]=e?M(M([],r[o],!0),t[o],!0):t[o]:typeof t[o]=="object"&&typeof r[o]=="object"?n[o]=j(r[o],t[o],e):n[o]=t[o]);return n},x=globalThis&&globalThis.__spreadArray||function(r,t,e){if(e||arguments.length===2)for(var n=0,o=t.length,i;n<o;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return r.concat(i||Array.prototype.slice.call(t))},d={defaults:{},errorType:null,polyfills:{fetch:null,FormData:null,URLSearchParams:null,performance:null,PerformanceObserver:null,AbortController:null},polyfill:function(r,t){for(var e=t===void 0?{}:t,n=e.doThrow,o=n===void 0?!0:n,i=e.instance,a=i===void 0?!1:i,l=[],h=2;h<arguments.length;h++)l[h-2]=arguments[h];var u=this.polyfills[r]||(typeof self!="undefined"?self[r]:null)||(typeof global!="undefined"?global[r]:null);if(o&&!u)throw new Error(r+" is not defined");return a&&u?new(u.bind.apply(u,x([void 0],l,!1))):u}},L=function(r,t,e,n){if(!r.getEntriesByName)return!1;var o=r.getEntriesByName(t);return o&&o.length>0?(e(o.reverse()[0]),n.clearMeasures&&n.clearMeasures(t),g.callbacks.delete(t),g.callbacks.size<1&&(g.observer.disconnect(),n.clearResourceTimings&&n.clearResourceTimings()),!0):!1},D=function(r,t){return!g.observer&&r&&t&&(g.observer=new t(function(e){g.callbacks.forEach(function(n,o){L(e,o,n,r)})}),r.clearResourceTimings&&r.clearResourceTimings()),g.observer},g={callbacks:new Map,observer:null,observe:function(r,t){if(!(!r||!t)){var e=d.polyfill("performance",{doThrow:!1}),n=d.polyfill("PerformanceObserver",{doThrow:!1});!D(e,n)||L(e,r,t,e)||(g.callbacks.size<1&&g.observer.observe({entryTypes:["resource","measure"]}),g.callbacks.set(r,t))}}},H=function(r){return function(t){return r.length===0?t:r.length===1?r[0](t):r.reduceRight(function(e,n,o){return o===r.length-2?n(e(t)):n(e)})}},w=function(){function r(t){this.error=t}return r}(),I=function(r){var t=r._url,e=r._catchers,n=r._resolvers,o=r._middlewares,i=r._options,a=new Map(e),l=j(d.defaults,i),h=d.polyfill("AbortController",{doThrow:!1,instance:!0});!l.signal&&h&&(l.signal=h.signal);var u={ref:null,clear:function(){u.ref&&(clearTimeout(u.ref),u.ref=null)}},m=H(o)(d.polyfill("fetch"))(t,l),_=m.catch(function(s){throw new w(s)}).then(function(s){if(u.clear(),!s.ok){if(s.type==="opaque"){var f=new Error("Opaque response");throw f.status=s.status,f.response=s,f}return s[d.errorType||"text"]().then(function(c){var E=new Error(c);throw E[d.errorType||"text"]=c,E.status=s.status,E.response=s,E})}return s}),T=function(s){return s.catch(function(f){u.clear();var c=f instanceof w?f.error:f;if(f instanceof w&&a.has("__fromFetch"))return a.get("__fromFetch")(c,r);if(a.has(c.status))return a.get(c.status)(c,r);if(a.has(c.name))return a.get(c.name)(c,r);throw c})},b=function(s){return function(f){return T(s?_.then(function(c){return c&&c[s]()}).then(function(c){return f?f(c):c}):_.then(function(c){return f?f(c):c}))}},p={res:b(null),json:b("json"),blob:b("blob"),formData:b("formData"),arrayBuffer:b("arrayBuffer"),text:b("text"),perfs:function(s){return m.then(function(f){return g.observe(f.url,s)}).catch(function(){}),p},setTimeout:function(s,f){return f===void 0&&(f=h),u.clear(),u.ref=setTimeout(function(){return f.abort()},s),p},controller:function(){return[h,p]},error:function(s,f){return a.set(s,f),p},badRequest:function(s){return p.error(400,s)},unauthorized:function(s){return p.error(401,s)},forbidden:function(s){return p.error(403,s)},notFound:function(s){return p.error(404,s)},timeout:function(s){return p.error(408,s)},internalError:function(s){return p.error(500,s)},fetchError:function(s){return p.error("__fromFetch",s)},onAbort:function(s){return p.error("AbortError",s)}};return n.reduce(function(s,f){return f(s,r)},p)},v=globalThis&&globalThis.__assign||function(){return v=Object.assign||function(r){for(var t,e=1,n=arguments.length;e<n;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=t[o])}return r},v.apply(this,arguments)},y=globalThis&&globalThis.__spreadArray||function(r,t,e){if(e||arguments.length===2)for(var n=0,o=t.length,i;n<o;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return r.concat(i||Array.prototype.slice.call(t))},J="application/json",N="Content-Type";function R(r){var t;return r===void 0&&(r={}),(t=Object.entries(r).find(function(e){var n=e[0];return n.toLowerCase()===N.toLowerCase()}))===null||t===void 0?void 0:t[1]}function S(r){return/^application\/.*json.*/.test(r)}var U=function(){function r(t,e,n,o,i,a){n===void 0&&(n=new Map),o===void 0&&(o=[]),i===void 0&&(i=[]),a===void 0&&(a=[]),this._url=t,this._options=e,this._catchers=n,this._resolvers=o,this._middlewares=i,this._deferredChain=a}return r.factory=function(t,e){return t===void 0&&(t=""),e===void 0&&(e={}),new r(t,e)},r.prototype.selfFactory=function(t){var e=t===void 0?{}:t,n=e.url,o=n===void 0?this._url:n,i=e.options,a=i===void 0?this._options:i,l=e.catchers,h=l===void 0?this._catchers:l,u=e.resolvers,m=u===void 0?this._resolvers:u,_=e.middlewares,T=_===void 0?this._middlewares:_,b=e.deferredChain,p=b===void 0?this._deferredChain:b;return new r(o,v({},a),new Map(h),y([],m,!0),y([],T,!0),y([],p,!0))},r.prototype.defaults=function(t,e){return e===void 0&&(e=!1),d.defaults=e?j(d.defaults,t):t,this},r.prototype.errorType=function(t){return d.errorType=t,this},r.prototype.polyfills=function(t){return d.polyfills=v(v({},d.polyfills),t),this},r.prototype.url=function(t,e){if(e===void 0&&(e=!1),e)return this.selfFactory({url:t});var n=this._url.split("?");return this.selfFactory({url:n.length>1?n[0]+t+"?"+n[1]:this._url+t})},r.prototype.options=function(t,e){return e===void 0&&(e=!0),this.selfFactory({options:e?j(this._options,t):t})},r.prototype.query=function(t,e){return e===void 0&&(e=!1),this.selfFactory({url:Q(this._url,t,e)})},r.prototype.headers=function(t){return this.selfFactory({options:j(this._options,{headers:t||{}})})},r.prototype.accept=function(t){return this.headers({Accept:t})},r.prototype.content=function(t){var e;return this.headers((e={},e[N]=t,e))},r.prototype.auth=function(t){return this.headers({Authorization:t})},r.prototype.catcher=function(t,e){var n=new Map(this._catchers);return n.set(t,e),this.selfFactory({catchers:n})},r.prototype.signal=function(t){return this.selfFactory({options:v(v({},this._options),{signal:t.signal})})},r.prototype.resolve=function(t,e){return e===void 0&&(e=!1),this.selfFactory({resolvers:e?[t]:y(y([],this._resolvers,!0),[t],!1)})},r.prototype.defer=function(t,e){return e===void 0&&(e=!1),this.selfFactory({deferredChain:e?[t]:y(y([],this._deferredChain,!0),[t],!1)})},r.prototype.middlewares=function(t,e){return e===void 0&&(e=!1),this.selfFactory({middlewares:e?t:y(y([],this._middlewares,!0),t,!0)})},r.prototype.method=function(t,e,n){e===void 0&&(e={}),n===void 0&&(n=null);var o=this.options(v(v({},e),{method:t})),i=R(o._options.headers),a=typeof n=="object"&&(!o._options.headers||!i||S(i));return o=n?a?o.json(n,i):o.body(n):o,I(o._deferredChain.reduce(function(l,h){return h(l,l._url,l._options)},o))},r.prototype.get=function(t){return this.method("GET",t)},r.prototype.delete=function(t){return this.method("DELETE",t)},r.prototype.put=function(t,e){return this.method("PUT",e,t)},r.prototype.post=function(t,e){return this.method("POST",e,t)},r.prototype.patch=function(t,e){return this.method("PATCH",e,t)},r.prototype.head=function(t){return this.method("HEAD",t)},r.prototype.opts=function(t){return this.method("OPTIONS",t)},r.prototype.replay=function(t){return this.method(this._options.method,t)},r.prototype.body=function(t){return this.selfFactory({options:v(v({},this._options),{body:t})})},r.prototype.json=function(t,e){var n=R(this._options.headers);return this.content(e||S(n)&&n||J).body(JSON.stringify(t))},r.prototype.formData=function(t,e){return e===void 0&&(e=!1),this.body(W(t,e))},r.prototype.formUrl=function(t){return this.body(typeof t=="string"?t:q(t)).content("application/x-www-form-urlencoded")},r}(),Q=function(r,t,e){var n;if(typeof t=="string")n=t;else{var o=d.polyfill("URLSearchParams",{instance:!0});for(var i in t)if(t[i]instanceof Array)for(var a=0,l=t[i];a<l.length;a++){var h=l[a];o.append(i,h)}else o.append(i,t[i]);n=o.toString()}var u=r.split("?");return n?e||u.length<2?u[0]+"?"+n:r+"&"+n:e?u[0]:r};function W(r,t,e,n){return t===void 0&&(t=!1),e===void 0&&(e=d.polyfill("FormData",{instance:!0})),n===void 0&&(n=[]),Object.entries(r).forEach(function(o){var i=o[0],a=o[1],l=n.reduce(function(_,T){return _?"".concat(_,"[").concat(T,"]"):T},null);if(l=l?"".concat(l,"[").concat(i,"]"):i,a instanceof Array)for(var h=0,u=a;h<u.length;h++){var m=u[h];e.append(l+"[]",m)}else t&&typeof a=="object"&&(!(t instanceof Array)||!t.includes(i))?a!==null&&W(a,t,e,y(y([],n,!0),[i],!1)):e.append(l,a)}),e}function k(r,t){return encodeURIComponent(r)+"="+encodeURIComponent(typeof t=="object"?JSON.stringify(t):""+t)}function q(r){return Object.keys(r).map(function(t){var e=r[t];return e instanceof Array?e.map(function(n){return k(t,n)}).join("&"):k(t,e)}).join("&")}var $=U.factory;$.default=U.factory;let B="";const C=r=>alert(r.json.message||r.json.error||r.message),A=$("/api/").options({credentials:"include"}).errorType("json").resolve(r=>r.badRequest(C).internalError(C).error(429,C)),X=()=>A.url("auth/logout").post().res().then(()=>{O.set(null),z("/")}),G=()=>A.url("auth/refresh_token").post().json(r=>O.set(!r.error&&r.token?r:null)),Z=r=>B=r;var tt=(r,t)=>r?(t?A.url(`${B}/`):A).resolve(e=>e.forbidden((n,o)=>G().then(()=>o.auth(`Bearer ${P(O).token}`)[o._options.method.toLowerCase()]()))).auth(`Bearer ${P(O).token}`):A;export{tt as a,X as l,G as r,Z as s};
